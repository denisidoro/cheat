#!/usr/bin/env bash
set -euo pipefail

export NAVI_HOME="$(cd "$(dirname "$0")/.." && pwd)"
TAR_DIR="${NAVI_HOME}/target/tar"

cd "$NAVI_HOME"
cargo build --release --locked

rm -rf "$TAR_DIR" 2> /dev/null || true
mkdir -p "$TAR_DIR" 2> /dev/null || tru

cp -r "${NAVI_HOME}/cheats" "$TAR_DIR"
cp "${NAVI_HOME}/navi.plugin.bash" "$TAR_DIR"
cp "${NAVI_HOME}/navi.plugin.fish" "$TAR_DIR"
cp "${NAVI_HOME}/navi.plugin.zsh" "$TAR_DIR"
cp "${NAVI_HOME}/target/release/navi" "$TAR_DIR"

cd "${NAVI_HOME}/target/tar"
tar -czf navi.tar.gz *
