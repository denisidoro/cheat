#!/usr/bin/env bash
set -euo pipefail

export NAVI_HOME="$(cd "$(dirname "$0")/.." && pwd)"
TAR_DIR="${NAVI_HOME}/target/tar"

cd "$NAVI_HOME"
cargo build --release --locked
chmod +x "${NAVI_HOME}/target/release/navi"

rm -rf "$TAR_DIR" 2> /dev/null || true
mkdir -p "$TAR_DIR" 2> /dev/null || true

cp -r "${NAVI_HOME}/cheats" "$TAR_DIR"

for f in \
    "${NAVI_HOME}/navi.plugin.bash" \
    "${NAVI_HOME}/navi.plugin.fish" \
    "${NAVI_HOME}/navi.plugin.zsh" \
    "${NAVI_HOME}/target/release/navi"; do
    cp "$f" "$TAR_DIR"
done

cd "${NAVI_HOME}/target/tar"
tar -czf navi.tar.gz *
